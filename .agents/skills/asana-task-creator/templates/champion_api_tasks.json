{
  "project_name": "KingmakerData",
  "parent_id": "1212613149794163",
  "subtasks": [
    {
      "platform": "API",
      "title": "Champion Role & Model Setup",
      "details": [
        "Add CHAMPION to USER_ROLES in choices.py",
        "Create Champion proxy model",
        "Add fields: parent_candidate FK, is_active (soft delete), password_reset_required (Boolean, default=True)"
      ],
      "tests": [
        "Verify CHAMPION role exists in USER_ROLES",
        "Verify Champion proxy model created correctly",
        "Verify parent_candidate FK relationship works",
        "Verify is_active default is True",
        "Verify password_reset_required default is True"
      ],
      "files": [
        "api/apps/users/choices.py",
        "api/apps/users/models.py"
      ],
      "estimate": "4h"
    },
    {
      "platform": "API",
      "title": "Champion Create API",
      "details": [
        "Endpoint tạo Champion (email, first_name, last_name, phone)",
        "Generate default random password (no password input from FE)",
        "Send welcome email với reset password link",
        "Set password_reset_required=True on creation"
      ],
      "tests": [
        "Verify Champion created with email, first_name, last_name, phone",
        "Verify default password is generated and hashed",
        "Verify welcome email sent with reset link",
        "Verify password_reset_required=True after creation",
        "Verify Champion belongs to correct parent_candidate",
        "Verify duplicate email validation works"
      ],
      "files": [
        "api/apps/users/api/views.py",
        "api/apps/users/api/serializers.py",
        "api/apps/users/services.py"
      ],
      "estimate": "5h"
    },
    {
      "platform": "API",
      "title": "Champion Password Reset Flow",
      "details": [
        "Check password_reset_required flag on each authenticated request",
        "Return flag in /me endpoint for FE to redirect",
        "Reset password API sets password_reset_required=False after successful reset"
      ],
      "tests": [
        "Verify /me endpoint returns password_reset_required flag",
        "Verify Champion with password_reset_required=True gets flag in response",
        "Verify reset password API updates password_reset_required=False",
        "Verify normal login works after password reset"
      ],
      "files": [
        "api/apps/users/api/serializers.py",
        "api/apps/users_auth/api/views.py"
      ],
      "estimate": "4h"
    },
    {
      "platform": "API",
      "title": "Champion CRUD & Permissions",
      "details": [
        "List Champions endpoint (filter by parent_candidate)",
        "Update Champion endpoint",
        "Deactivate Champion endpoint (soft delete: is_active=False)",
        "Permission classes: IsChampion, CanManageChampion (Candidate + Campaign Manager)"
      ],
      "tests": [
        "Verify Candidate can list their Champions",
        "Verify Campaign Manager can list Candidate's Champions",
        "Verify Champion cannot list other Champions",
        "Verify Update Champion works for Candidate",
        "Verify Deactivate sets is_active=False",
        "Verify deactivated Champion cannot login",
        "Verify permission classes block unauthorized access"
      ],
      "files": [
        "api/apps/users/api/views.py",
        "api/apps/users/api/serializers.py",
        "api/apps/users/permissions.py"
      ],
      "estimate": "5h"
    },
    {
      "platform": "API",
      "title": "ChampionArea Model",
      "details": [
        "Create ChampionArea model with fields: champion FK, candidate FK, name, polygon, lal_voter_ids, query_params, is_active",
        "Add unique constraint: 1 Champion = 1 active Area",
        "Add migration"
      ],
      "tests": [
        "Verify ChampionArea model created correctly",
        "Verify FK relationships work",
        "Verify polygon ArrayField stores correctly",
        "Verify lal_voter_ids ArrayField stores correctly",
        "Verify unique constraint prevents multiple active areas per Champion"
      ],
      "files": [
        "api/apps/campaigns/models.py"
      ],
      "estimate": "3h"
    },
    {
      "platform": "API",
      "title": "Create/Change Area Manager API",
      "details": [
        "Create Area Manager endpoint (similar to Blockwalk flow)",
        "Input: area_name, champion_id, polygon, lal_voter_ids, query_params",
        "Change Area endpoint: deactivate old area, create new area",
        "Validation: 1 Champion = 1 active Area at a time",
        "Trigger CSV generation on area creation/change"
      ],
      "tests": [
        "Verify Create Area Manager works with valid data",
        "Verify Champion can only have 1 active area",
        "Verify Change Area deactivates old area",
        "Verify Change Area creates new area correctly",
        "Verify CSV generation triggered on create",
        "Verify CSV generation triggered on change",
        "Verify validation rejects invalid polygon",
        "Verify only Candidate/Campaign Manager can create area"
      ],
      "files": [
        "api/apps/campaigns/api/views.py",
        "api/apps/campaigns/api/serializers.py",
        "api/apps/campaigns/services/"
      ],
      "estimate": "8h"
    },
    {
      "platform": "API",
      "title": "Tag Sync (Candidate → Champion)",
      "details": [
        "Champion inherits tags from parent_candidate (view-only)",
        "Filter Tag queryset by parent_candidate for Champion users",
        "Block create/update/delete tag actions for Champion role"
      ],
      "tests": [
        "Verify Champion can view Candidate's tags",
        "Verify Champion cannot create new tags",
        "Verify Champion cannot update existing tags",
        "Verify Champion cannot delete tags",
        "Verify tag list API returns parent_candidate's tags for Champion"
      ],
      "files": [
        "api/apps/dashboard/api/views.py",
        "api/apps/dashboard/api/serializers.py"
      ],
      "estimate": "5h"
    },
    {
      "platform": "API",
      "title": "Status Sync (2-way) & Conflict Resolution",
      "details": [
        "Champion update support_status syncs to Candidate's ContactSupportStatus",
        "Candidate updates sync down to Champion's visible data",
        "Conflict resolution: Candidate data takes priority",
        "Implement Django signals or Celery tasks for sync"
      ],
      "tests": [
        "Verify Champion status update syncs to Candidate",
        "Verify Candidate tag update visible to Champion",
        "Verify conflict resolution: Candidate wins on simultaneous update",
        "Verify sync happens in real-time or near-real-time",
        "Verify sync only affects voters in Champion's area"
      ],
      "files": [
        "api/apps/dashboard/services/",
        "api/apps/dashboard/signals.py",
        "api/apps/dashboard/tasks.py"
      ],
      "estimate": "10h"
    },
    {
      "platform": "API",
      "title": "Champion CSV Generation",
      "details": [
        "Generate CSV for Champion from ChampionArea.lal_voter_ids",
        "Store CSV path in Champion.dashboard_data_uri",
        "Regenerate CSV when area changes",
        "Celery task for async generation"
      ],
      "tests": [
        "Verify CSV generated with correct voter subset",
        "Verify dashboard_data_uri updated after generation",
        "Verify CSV regenerated on area change",
        "Verify old CSV cleaned up on regeneration",
        "Verify CSV format matches existing dashboard CSV"
      ],
      "files": [
        "api/apps/dashboard/services/generate_csv.py",
        "api/apps/dashboard/tasks.py"
      ],
      "estimate": "11h"
    },
    {
      "platform": "API",
      "title": "Dashboard API Scoping for Champion",
      "details": [
        "Update get_position_file_path to return Champion's CSV",
        "Filter ContactSupportStatus by ChampionArea.lal_voter_ids",
        "Scoped analytics: only data within Champion's area"
      ],
      "tests": [
        "Verify /me returns Champion's dashboard_data_uri",
        "Verify ContactSupportStatus filtered by area",
        "Verify analytics show only area data",
        "Verify Champion cannot access data outside area"
      ],
      "files": [
        "api/apps/users/api/serializers.py",
        "api/apps/users/services.py",
        "api/apps/dashboard/api/views.py"
      ],
      "estimate": "9h"
    },
    {
      "platform": "API",
      "title": "Blockwalk Scoped Access for Champion",
      "details": [
        "Champion can view Candidate's blockwalks that overlap with their area",
        "Champion cannot create/delete blockwalks",
        "Filter by lal_voter_ids overlap or polygon intersection"
      ],
      "tests": [
        "Verify Champion can view overlapping blockwalks",
        "Verify Champion cannot see blockwalks outside area",
        "Verify Champion cannot create blockwalks",
        "Verify Champion cannot delete blockwalks",
        "Verify blockwalk data is read-only for Champion"
      ],
      "files": [
        "api/apps/campaigns/api/views.py"
      ],
      "estimate": "3h"
    },
    {
      "platform": "API",
      "title": "Unit & Integration Tests",
      "details": [
        "Unit tests for Champion models, serializers, permissions",
        "Integration tests for E2E flow: create Champion → assign area → update status → sync"
      ],
      "tests": [
        "All unit tests pass",
        "E2E flow test passes",
        "Permission tests cover all scenarios",
        "Sync tests verify data consistency"
      ],
      "files": [
        "api/apps/users/tests.py",
        "api/apps/campaigns/tests.py",
        "api/apps/dashboard/tests.py"
      ],
      "estimate": "8h"
    },
    {
      "platform": "API",
      "title": "API Documentation Update",
      "details": [
        "Update Swagger/OpenAPI docs for Champion endpoints",
        "Document sync behavior and conflict resolution",
        "Document permission requirements"
      ],
      "tests": [
        "Verify Swagger docs accessible",
        "Verify all Champion endpoints documented",
        "Verify request/response schemas correct"
      ],
      "files": [
        "api/apps/users/api/views.py",
        "api/apps/campaigns/api/views.py"
      ],
      "estimate": "2h"
    }
  ]
}
